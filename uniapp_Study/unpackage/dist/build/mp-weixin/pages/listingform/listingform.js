"use strict";const e=require("../../common/vendor.js"),o=require("../../common/assets.js"),s={data:()=>({housings:[],isRefreshing:!1,isGeneratingVideo:!1}),methods:{async fetchLatestHousings(){try{this.isRefreshing=!0;const o=await e.index.request({url:"http://101.126.149.86:8000/get_latest_housings",method:"GET"});if(o&&200===o.statusCode){let e=0;this.housings=o.data.housings.map((o=>({...o,showMask:!1,_id:o._id,house_id:e++}))),console.log("Fetched housings:",this.housings)}else console.error("Failed to fetch latest housings",o);this.isRefreshing=!1}catch(o){console.error("Error fetching latest housings",o),this.isRefreshing=!1}},generateVideo(o){if(!o||!o._id||!o._id.$oid)return void e.index.showToast({title:"无效的房源数据",icon:"none"});const s=o._id.$oid;console.log("准备生成视频，房源ID:",s),e.index.setStorageSync("enterSource","generate"),e.index.setStorageSync("housingId",s),e.index.switchTab({url:"/pages/video/video"}),e.index.request({url:"http://101.126.149.86:8000/generate_video",method:"POST",header:{"content-type":"application/json"},data:{house_id:s},success:s=>{200===s.statusCode?(e.index.setStorageSync("enterSource","view"),e.index.setStorageSync("videoUrl",o.video_url),e.index.reLaunch({url:"/pages/video/video",success:()=>{console.log("页面跳转成功")},fail:o=>{console.error("页面跳转失败",o),e.index.switchTab({url:"/pages/video/video"})}})):e.index.showToast({title:"生成视频请求失败",icon:"none"})},fail:o=>{console.error("请求失败:",o),e.index.showToast({title:"网络请求失败",icon:"none"})},complete:()=>{e.index.hideLoading()}})},viewVideo(o){e.index.setStorageSync("enterSource","view"),e.index.setStorageSync("videoUrl",o.video_url),e.index.reLaunch({url:"/pages/video/video",success:()=>{console.log("页面跳转成功")},fail:o=>{console.error("页面跳转失败",o),e.index.switchTab({url:"/pages/video/video"})}})},toggleMask(e){e.showMask=!e.showMask}},onShow(){},onPullDownRefresh(){console.log("下拉时执行获取最新房屋信息的方法"),this.fetchLatestHousings().then((()=>{e.index.stopPullDownRefresh()}))},mounted(){console.log("mounted执行获取最新房屋信息的方法"),this.fetchLatestHousings()}};const i=e._export_sfc(s,[["render",function(s,i,t,n,r,d){return{a:e.f(r.housings,((o,s,i)=>e.e({a:o.images[0],b:e.t(o.community),c:e.t(o.area),d:e.t(o.layout),e:e.t(o.floor),f:e.t(o.total_price),g:o.showMask},(o.showMask,{}),{h:o.showMask},o.showMask?{i:e.t(r.isGeneratingVideo?"生成中...":"生成视频"),j:o.is_video_generated||r.isGeneratingVideo,k:e.o((e=>d.generateVideo(o)),o.house_id),l:!o.is_video_generated,m:e.o((e=>d.viewVideo(o)),o.house_id)}:{},{n:o.house_id,o:e.o((e=>d.toggleMask(o)),o.house_id)}))),b:o._imports_0,c:o._imports_1,d:o._imports_2,e:o._imports_3}}],["__scopeId","data-v-9b02bc39"]]);wx.createPage(i);
